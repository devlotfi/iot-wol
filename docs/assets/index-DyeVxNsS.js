import{r as j,j as e,m as N,a as w,b as D,c as O,d as E,e as d,u as C,n as V,o as k}from"./heroui-BoPcx50s.js";import{R as g,u as q,b as P,c as M,E as W}from"./index-Dc4KBpjX.js";import{r as y,s as A,t as _,w as $,x as L,e as z}from"./fortawesome-free-solid-svg-icons-D-Y0_Nts.js";import{u as b,F as u,M as Q}from"./mqtt-QQP8PpdR.js";import{v as I,u as F,c as R,a as f,V as h,D as S,H as K,L as B,E as T}from"./loading-screen-BTCybk5r.js";function H({isOpen:s,onClose:o,onOpenChange:i}){const{t:r}=b(),{rxdb:n}=j.useContext(g),c=q(),{mutate:t,isPending:m}=P({mutationFn:async a=>{console.log({id:I(),name:a.name,mac:a.mac,ip:a.ip||null}),await n.devices.insert({id:I(),name:a.name,mac:a.mac,ip:a.ip||null}),c.resetQueries({queryKey:["DEVICES"]}),o()}}),l=F({initialValues:{name:"",mac:"",ip:""},validationSchema:R({name:f().required(),mac:f().matches(/^([0-9A-Fa-f]{2}:){5}[0-9A-Fa-f]{2}$/,{message:"Invalid mac adress"}).required(),ip:f().matches(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,{message:"Invalid ip adress"})}),onSubmit(a){t(a)}});return e.jsx(N,{backdrop:"blur",scrollBehavior:"outside",isOpen:s,onOpenChange:i,children:e.jsx(w,{children:()=>e.jsxs("form",{onSubmit:l.handleSubmit,className:"flex flex-col gap-[1rem]",children:[e.jsx(D,{className:"flex flex-col gap-1",children:r("connected")}),e.jsxs(O,{children:[e.jsx(h,{isRequired:!0,formik:l,name:"name",label:r("name"),classNames:{inputWrapper:"shadow-none border border-divider"}}),e.jsx(h,{isRequired:!0,formik:l,name:"mac",label:r("macAddress"),classNames:{inputWrapper:"shadow-none border border-divider"}}),e.jsx(h,{formik:l,name:"ip",label:r("ipAddressIOptional"),classNames:{inputWrapper:"shadow-none border border-divider"}})]}),e.jsx(E,{children:e.jsx(d,{fullWidth:!0,type:"submit",color:"primary",isLoading:m,startContent:e.jsx(u,{icon:y}),children:r("add")})})]})})})}function G({device:s,isOpen:o,onClose:i,onOpenChange:r}){const{t:n}=b(),{rxdb:c}=j.useContext(g),t=q(),{mutate:m,isPending:l}=P({mutationFn:async()=>{const a=await c.devices.findOne(s.id).exec();a&&(await a.remove(),t.resetQueries({queryKey:["DEVICES"]}),i())}});return e.jsx(N,{backdrop:"blur",isOpen:o,onOpenChange:r,children:e.jsx(w,{children:()=>e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"flex flex-col gap-1",children:n("deleteDevice")}),e.jsx(O,{children:e.jsx("div",{className:"flex",children:n("deleteConfirmation")})}),e.jsxs(E,{children:[e.jsx(d,{variant:"bordered",className:"border border-divider",onPress:i,children:n("cancel")}),e.jsx(d,{color:"danger",startContent:e.jsx(u,{icon:A}),isLoading:l,onPress:()=>m(),children:n("delete")})]})]})})})}function J({device:s,isOpen:o,onClose:i,onOpenChange:r}){const{t:n}=b(),{rxdb:c}=j.useContext(g),t=q(),{mutate:m,isPending:l}=P({mutationFn:async x=>{console.log(x);const v=await c.devices.findOne(s.id).exec();v&&(await v.incrementalModify(p=>(p.name=x.name,p.mac=x.mac,p.ip=x.ip||null,p)),t.resetQueries({queryKey:["DEVICES"]}),i())}}),a=F({initialValues:{name:s.name,mac:s.mac,ip:s.ip||""},validationSchema:R({name:f().required(),mac:f().matches(/^([0-9A-Fa-f]{2}:){5}[0-9A-Fa-f]{2}$/,{message:"Invalid mac adress"}).required(),ip:f().matches(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,{message:"Invalid ip adress"})}),onSubmit(x){m(x)}});return e.jsx(N,{backdrop:"blur",scrollBehavior:"outside",isOpen:o,onOpenChange:r,children:e.jsx(w,{children:()=>e.jsxs("form",{onSubmit:a.handleSubmit,className:"flex flex-col gap-[1rem]",children:[e.jsx(D,{className:"flex flex-col gap-1",children:n("editDevice")}),e.jsxs(O,{children:[e.jsx(h,{isRequired:!0,formik:a,name:"name",label:n("name"),classNames:{inputWrapper:"shadow-none border border-divider"}}),e.jsx(h,{isRequired:!0,formik:a,name:"mac",label:n("macAddress"),classNames:{inputWrapper:"shadow-none border border-divider"}}),e.jsx(h,{formik:a,name:"ip",label:n("ipAddressIOptional"),classNames:{inputWrapper:"shadow-none border border-divider"}})]}),e.jsx(E,{children:e.jsx(d,{fullWidth:!0,type:"submit",color:"primary",isLoading:l,startContent:e.jsx(u,{icon:_}),children:n("edit")})})]})})})}function U({device:s}){const{t:o}=b(),{connectionData:i,wakeDevice:r,pingDevice:n}=j.useContext(Q),{isOpen:c,onOpen:t,onClose:m,onOpenChange:l}=C(),{isOpen:a,onOpen:x,onClose:v,onOpenChange:p}=C();return e.jsxs(V,{className:"flex-row relative overflow-visible",children:[e.jsxs(k,{children:[e.jsx(G,{device:s,isOpen:a,onOpen:x,onOpenChange:p,onClose:v}),e.jsx(J,{device:s,isOpen:c,onOpen:t,onOpenChange:l,onClose:m}),e.jsxs("div",{className:"flex flex-col md:flex-row pr-[1.5rem] gap-[1rem]",children:[e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("div",{className:"flex font-bold text-[15pt] break-all",children:s.name}),e.jsx(S,{name:"MAC",value:s.mac}),e.jsx(S,{name:"IP",value:s.ip||"Not set"})]}),e.jsxs("div",{className:"flex md:flex-col gap-[0.3rem]",children:[e.jsx(d,{size:"sm",radius:"full",variant:"bordered",className:"w-full md:w-auto border border-divider",isDisabled:!(i&&i.isConnected)||!s.ip,endContent:e.jsx(u,{icon:$}),onPress:()=>n(s),children:"Ping"}),e.jsx(d,{size:"sm",radius:"full",variant:"bordered",className:"w-full md:w-auto border border-divider",endContent:e.jsx(u,{icon:_}),onPress:()=>t(),children:o("edit")}),e.jsx(d,{size:"sm",radius:"full",variant:"bordered",className:"w-full md:w-auto border border-divider",endContent:e.jsx(u,{icon:A}),onPress:()=>x(),children:o("delete")})]})]})]}),e.jsx("div",{className:"flex items-center",children:e.jsx(d,{isIconOnly:!0,color:"primary",variant:"shadow",radius:"full",size:"lg",isDisabled:!(i&&i.isConnected),className:"absolute right-0 translate-x-[50%] z-10",onPress:()=>r(s),children:e.jsx(u,{icon:L})})})]})}function ae(){const{t:s}=b(),{rxdb:o}=j.useContext(g),{isOpen:i,onOpen:r,onClose:n,onOpenChange:c}=C(),{data:t,isLoading:m,isError:l}=M({queryKey:["DEVICES"],queryFn:async()=>await o.devices.find().exec()});return e.jsx("div",{className:"flex flex-1 flex-col items-center",children:e.jsxs("div",{className:"flex flex-1 flex-col max-w-screen-md w-full",children:[e.jsxs("div",{className:"flex justify-between items-center z-10 py-[1rem] px-[1rem]",children:[e.jsx(K,{icon:z,title:`${s("devices")} (${t?.length||0})`}),e.jsx(d,{isIconOnly:!0,color:"primary",variant:"bordered",radius:"full",className:"h-[3.5rem] w-[3.5rem]",onPress:r,children:e.jsx(u,{icon:y,className:"text-[18pt]"})}),e.jsx(H,{isOpen:i,onOpenChange:c,onClose:n,onOpen:r})]}),m?e.jsx(B,{}):l?e.jsx(W,{}):t&&t.length?e.jsx("div",{className:"flex flex-col flex-1 mt-[0.5rem] gap-[1rem] pl-[1rem] pr-[2.5rem] pb-[5rem]",children:t.map(a=>e.jsx(U,{device:a},a.id))}):e.jsxs("div",{className:"flex flex-1 text-center justify-center items-center flex-col gap-[1rem] px-[0.5rem]",children:[e.jsx("img",{src:T,alt:"device",className:"h-[12rem] md:h-[15rem]"}),e.jsx("div",{className:"flex text-[18pt] font-bold",children:s("noDevices.title")}),e.jsx("div",{className:"flex text-[13pt] opacity-70",children:s("noDevices.subTitle")}),e.jsx(d,{radius:"full",color:"primary",variant:"ghost",startContent:e.jsx(u,{icon:y}),onPress:r,children:s("addDevice")})]})]})})}export{ae as component};
