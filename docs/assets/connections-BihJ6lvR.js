import{r as j,j as e,m as v,a as O,b as q,c as S,L as F,d as P,e as h,u as w,l as M,n as Q}from"./heroui-XROrhaFW.js";import{R as T,u as E,c as g,d as $,E as K}from"./index-BYs_WIc6.js";import{F as c,M as B}from"./mqtt-D0UgJ9oq.js";import{q as y,r as _,s as V,t as H,u as Z,j as G,i as X,g as J}from"./fortawesome-free-solid-svg-icons-CoRImyFt.js";import{u as D,c as A,a as p,V as x,v as Y,D as N,H as ee,L as se,E as ne}from"./loading-screen-Do3_2Vye.js";function re({isOpen:s,onClose:i,onOpenChange:o}){const{rxdb:u}=j.useContext(T),d=E(),{mutate:r,isPending:m}=g({mutationFn:async t=>{await u.connections.insert({id:Y(),name:t.name,url:t.url,topic:t.topic,responseTopic:t.responseTopic,username:t.username||null}),d.resetQueries({queryKey:["CONNECTIONS"]}),i()}}),a=D({initialValues:{name:"",url:"",username:"",topic:"iot-wol/topic",responseTopic:"iot-wol/response-topic"},validationSchema:A({name:p().required(),url:p().matches(/^(wss?|WSS?):\/\/([a-zA-Z0-9.-]+|\[[0-9a-fA-F:]+\])(:\d{1,5})?(\/[^\s]*)?$/,{message:"Invalid mac adress"}).required(),username:p(),topic:p().required(),responseTopic:p().required()}),onSubmit(t){r(t)}}),[n,b]=j.useState(!0);return e.jsx(v,{backdrop:"blur",scrollBehavior:"outside",isOpen:s,onOpenChange:o,children:e.jsx(O,{children:()=>e.jsxs("form",{onSubmit:a.handleSubmit,className:"flex flex-col gap-[1rem]",children:[e.jsx(q,{className:"flex flex-col gap-1",children:"Add connection"}),e.jsxs(S,{children:[e.jsx(x,{isRequired:!0,formik:a,name:"name",label:"Name",classNames:{inputWrapper:"shadow-none border border-divider"}}),e.jsx(x,{isRequired:!0,formik:a,name:"url",label:"URL",classNames:{inputWrapper:"shadow-none border border-divider"}}),e.jsx(x,{isRequired:!0,formik:a,name:"topic",label:"Topic",classNames:{inputWrapper:"shadow-none border border-divider"}}),e.jsx(x,{isRequired:!0,formik:a,name:"responseTopic",label:"Response Topic",classNames:{inputWrapper:"shadow-none border border-divider"}}),e.jsx(F,{isSelected:n,onValueChange:t=>{a.setFieldValue("username",""),b(t)},children:"Use authenthication"}),n?e.jsx(x,{isRequired:!0,formik:a,name:"username",label:"Username",classNames:{inputWrapper:"shadow-none border border-divider"}}):null]}),e.jsx(P,{children:e.jsx(h,{fullWidth:!0,type:"submit",color:"primary",isLoading:m,startContent:e.jsx(c,{icon:y}),children:"Add"})})]})})})}function ae({connection:s,isOpen:i,onClose:o,onOpenChange:u}){const{rxdb:d}=j.useContext(T),r=E(),{mutate:m,isPending:a}=g({mutationFn:async()=>{const n=await d.connections.findOne(s.id).exec();n&&(await n.remove(),r.resetQueries({queryKey:["CONNECTIONS"]}),o())}});return e.jsx(v,{backdrop:"blur",isOpen:i,onOpenChange:u,children:e.jsx(O,{children:()=>e.jsxs(e.Fragment,{children:[e.jsx(q,{className:"flex flex-col gap-1",children:"Delete connection"}),e.jsx(S,{children:e.jsx("div",{className:"flex",children:"Are you sure you want to delete this connection ?"})}),e.jsxs(P,{children:[e.jsx(h,{variant:"bordered",className:"border border-divider",onPress:o,children:"Cancel"}),e.jsx(h,{color:"danger",startContent:e.jsx(c,{icon:_}),isLoading:a,onPress:()=>m(),children:"Delete"})]})]})})})}function ie({connection:s,isOpen:i,onClose:o,onOpenChange:u}){const{rxdb:d}=j.useContext(T),r=E(),{mutate:m,isPending:a}=g({mutationFn:async l=>{console.log(l);const C=await d.connections.findOne(s.id).exec();C&&(await C.incrementalModify(f=>(f.name=l.name,f.name=l.name,f.url=l.url,f.topic=l.topic,f.responseTopic=l.responseTopic,f.username=l.username||null,f)),r.resetQueries({queryKey:["CONNECTIONS"]}),o())}}),n=D({initialValues:{name:s.name,url:s.url,username:s.username||"",topic:s.topic,responseTopic:s.responseTopic},validationSchema:A({name:p().required(),url:p().matches(/^(wss?|WSS?):\/\/([a-zA-Z0-9.-]+|\[[0-9a-fA-F:]+\])(:\d{1,5})?(\/[^\s]*)?$/,{message:"Invalid mac adress"}).required(),username:p(),topic:p().required(),responseTopic:p().required()}),onSubmit(l){m(l)}}),[b,t]=j.useState(!!s.username);return e.jsx(v,{backdrop:"blur",scrollBehavior:"outside",isOpen:i,onOpenChange:u,children:e.jsx(O,{children:()=>e.jsxs("form",{onSubmit:n.handleSubmit,className:"flex flex-col gap-[1rem]",children:[e.jsx(q,{className:"flex flex-col gap-1",children:"Edit connection"}),e.jsxs(S,{children:[e.jsx(x,{isRequired:!0,formik:n,name:"name",label:"Name",classNames:{inputWrapper:"shadow-none border border-divider"}}),e.jsx(x,{isRequired:!0,formik:n,name:"url",label:"URL",classNames:{inputWrapper:"shadow-none border border-divider"}}),e.jsx(x,{isRequired:!0,formik:n,name:"topic",label:"Topic",classNames:{inputWrapper:"shadow-none border border-divider"}}),e.jsx(x,{isRequired:!0,formik:n,name:"responseTopic",label:"Response Topic",classNames:{inputWrapper:"shadow-none border border-divider"}}),e.jsx(F,{isSelected:b,onValueChange:l=>{n.setFieldValue("username",""),t(l)},children:"Use authenthication"}),b?e.jsx(x,{isRequired:!0,formik:n,name:"username",label:"Username",classNames:{inputWrapper:"shadow-none border border-divider"}}):null]}),e.jsx(P,{children:e.jsx(h,{fullWidth:!0,type:"submit",color:"primary",isLoading:a,startContent:e.jsx(c,{icon:V}),children:"Edit"})})]})})})}function oe({onSubmit:s,isOpen:i,onClose:o,onOpenChange:u}){const d=D({initialValues:{password:""},validationSchema:A({password:p().required()}),onSubmit(n){s(n.password),o()}}),[r,m]=j.useState(!1),a=()=>m(!r);return e.jsx(v,{backdrop:"blur",isOpen:i,onOpenChange:u,children:e.jsx(O,{children:()=>e.jsxs("form",{onSubmit:d.handleSubmit,className:"flex flex-col gap-[1rem]",children:[e.jsx(q,{className:"flex flex-col gap-1",children:"Connection authenthication"}),e.jsx(S,{children:e.jsx(x,{isRequired:!0,type:r?"text":"password",formik:d,name:"password",label:"Password",classNames:{inputWrapper:"shadow-none border border-divider"},endContent:e.jsx("button",{"aria-label":"toggle password visibility",className:"focus:outline-solid outline-transparent",type:"button",onClick:a,children:r?e.jsx(c,{icon:H}):e.jsx(c,{icon:Z})})})}),e.jsx(P,{children:e.jsx(h,{fullWidth:!0,type:"submit",color:"primary",startContent:e.jsx(c,{icon:y}),children:"Connect"})})]})})})}function te({connection:s}){const{connectionData:i,mqttConnect:o,mqttDisconnect:u}=j.useContext(B),{isOpen:d,onOpen:r,onClose:m,onOpenChange:a}=w(),{isOpen:n,onOpen:b,onClose:t,onOpenChange:l}=w(),{isOpen:C,onOpen:f,onClose:k,onOpenChange:I}=w(),{mutate:W,isPending:L}=g({mutationFn:async R=>{await o(s,R)}}),{mutate:U,isPending:z}=g({mutationFn:async()=>{await u()}});return e.jsxs(M,{className:"flex-row relative overflow-visible",children:[e.jsxs(Q,{children:[e.jsx(ae,{connection:s,isOpen:n,onOpen:b,onOpenChange:l,onClose:t}),e.jsx(ie,{connection:s,isOpen:d,onOpen:r,onOpenChange:a,onClose:m}),s.username?e.jsx(oe,{isOpen:C,onOpen:f,onOpenChange:I,onClose:k,onSubmit:R=>W(R)}):null,e.jsxs("div",{className:"flex flex-col md:flex-row pr-[1.5rem] gap-[1rem]",children:[e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("div",{className:"flex font-bold text-[15pt] break-all",children:s.name}),e.jsx(N,{name:"URL",value:s.url}),e.jsx(N,{name:"Topic",value:s.topic}),e.jsx(N,{name:"Response topic",value:s.responseTopic}),s.username?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex font-bold text-[12pt]",children:"Authenthication"}),e.jsx(N,{name:"Username",value:s.username})]}):null]}),e.jsxs("div",{className:"flex md:flex-col gap-[0.3rem]",children:[e.jsx(h,{size:"sm",radius:"full",variant:"bordered",className:"w-full md:w-auto border border-divider",isDisabled:i!==null,endContent:e.jsx(c,{icon:V}),onPress:()=>r(),children:"Edit"}),e.jsx(h,{size:"sm",radius:"full",variant:"bordered",className:"w-full md:w-auto border border-divider",isDisabled:i!==null,endContent:e.jsx(c,{icon:_}),onPress:()=>b(),children:"Delete"})]})]})]}),e.jsx("div",{className:"flex items-center",children:i&&i.id===s.id?e.jsx(h,{isIconOnly:!0,color:"danger",variant:"shadow",radius:"full",size:"lg",isLoading:z,className:"absolute right-0 translate-x-[50%] z-10",onPress:()=>U(),children:e.jsx(c,{icon:G})}):e.jsx(h,{isIconOnly:!0,color:"primary",variant:"shadow",radius:"full",size:"lg",isDisabled:i!==null,isLoading:L,className:"absolute right-0 translate-x-[50%] z-10",onPress:()=>{console.log("lol",s.username),s.username?(console.log("lol"),f()):W(void 0)},children:e.jsx(c,{icon:X})})})]})}function pe(){const{rxdb:s}=j.useContext(T),{isOpen:i,onOpen:o,onClose:u,onOpenChange:d}=w(),{data:r,isLoading:m,isError:a}=$({queryKey:["CONNECTIONS"],queryFn:async()=>await s.connections.find().exec()});return e.jsx("div",{className:"flex flex-1 flex-col items-center",children:e.jsxs("div",{className:"flex flex-1 flex-col max-w-screen-md w-full",children:[e.jsxs("div",{className:"flex justify-between items-center z-10 py-[1rem] px-[1rem]",children:[e.jsx(ee,{icon:J,title:`Connections (${r?.length||0})`}),e.jsx(h,{isIconOnly:!0,color:"primary",variant:"bordered",radius:"full",className:"h-[3.5rem] w-[3.5rem]",onPress:o,children:e.jsx(c,{icon:y,className:"text-[18pt]"})}),e.jsx(re,{isOpen:i,onOpenChange:d,onClose:u,onOpen:o})]}),m?e.jsx(se,{}):a?e.jsx(K,{}):r&&r.length?e.jsx("div",{className:"flex flex-col flex-1 mt-[0.5rem] gap-[1rem] pl-[1rem] pr-[2.5rem] pb-[5rem]",children:r.map(n=>e.jsx(te,{connection:n},n.id))}):e.jsxs("div",{className:"flex flex-1 text-center justify-center items-center flex-col gap-[1rem] px-[0.5rem]",children:[e.jsx("img",{src:ne,alt:"device",className:"h-[12rem] md:h-[15rem]"}),e.jsx("div",{className:"flex text-[18pt] font-bold",children:"No connections yet"}),e.jsx("div",{className:"flex text-[13pt] opacity-70",children:"Start by adding an MQTT broker connection"}),e.jsx(h,{radius:"full",color:"primary",variant:"ghost",startContent:e.jsx(c,{icon:y}),onPress:o,children:"Add connection"})]})]})})}export{pe as component};
