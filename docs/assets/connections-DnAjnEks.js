import{r as b,j as e,m as q,a as S,b as P,c as T,L as V,d as R,e as f,u as y,n as U,o as K}from"./heroui-BoPcx50s.js";import{R as E,u as D,b as N,c as B,E as H}from"./index-Dc4KBpjX.js";import{u as g,F as m,M as Z}from"./mqtt-QQP8PpdR.js";import{r as O,s as I,t as L,u as G,v as X,j as J,i as Y,g as ee}from"./fortawesome-free-solid-svg-icons-D-Y0_Nts.js";import{u as A,c as F,a as x,V as h,v as se,D as v,H as ne,L as re,E as ae}from"./loading-screen-BTCybk5r.js";function ie({isOpen:s,onClose:l,onOpenChange:t}){const{t:a}=g(),{rxdb:r}=b.useContext(E),u=D(),{mutate:i,isPending:p}=N({mutationFn:async d=>{await r.connections.insert({id:se(),name:d.name,url:d.url,topic:d.topic,responseTopic:d.responseTopic,username:d.username||null}),u.resetQueries({queryKey:["CONNECTIONS"]}),l()}}),o=A({initialValues:{name:"",url:"",username:"",topic:"iot-wol/topic",responseTopic:"iot-wol/response-topic"},validationSchema:F({name:x().required(),url:x().matches(/^(wss?|WSS?):\/\/([a-zA-Z0-9.-]+|\[[0-9a-fA-F:]+\])(:\d{1,5})?(\/[^\s]*)?$/,{message:"Invalid mac adress"}).required(),username:x(),topic:x().required(),responseTopic:x().required()}),onSubmit(d){i(d)}}),[n,C]=b.useState(!0);return e.jsx(q,{backdrop:"blur",scrollBehavior:"outside",isOpen:s,onOpenChange:t,children:e.jsx(S,{children:()=>e.jsxs("form",{onSubmit:o.handleSubmit,className:"flex flex-col gap-[1rem]",children:[e.jsx(P,{className:"flex flex-col gap-1",children:a("addConnection")}),e.jsxs(T,{children:[e.jsx(h,{isRequired:!0,formik:o,name:"name",label:a("name"),classNames:{inputWrapper:"shadow-none border border-divider"}}),e.jsx(h,{isRequired:!0,formik:o,name:"url",label:"URL",classNames:{inputWrapper:"shadow-none border border-divider"}}),e.jsx(h,{isRequired:!0,formik:o,name:"topic",label:"Topic",classNames:{inputWrapper:"shadow-none border border-divider"}}),e.jsx(h,{isRequired:!0,formik:o,name:"responseTopic",label:"Response Topic",classNames:{inputWrapper:"shadow-none border border-divider"}}),e.jsx(V,{isSelected:n,onValueChange:d=>{o.setFieldValue("username",""),C(d)},children:a("useAuthenthication")}),n?e.jsx(h,{isRequired:!0,formik:o,name:"username",label:a("username"),classNames:{inputWrapper:"shadow-none border border-divider"}}):null]}),e.jsx(R,{children:e.jsx(f,{fullWidth:!0,type:"submit",color:"primary",isLoading:p,startContent:e.jsx(m,{icon:O}),children:a("add")})})]})})})}function oe({connection:s,isOpen:l,onClose:t,onOpenChange:a}){const{t:r}=g(),{rxdb:u}=b.useContext(E),i=D(),{mutate:p,isPending:o}=N({mutationFn:async()=>{const n=await u.connections.findOne(s.id).exec();n&&(await n.remove(),i.resetQueries({queryKey:["CONNECTIONS"]}),t())}});return e.jsx(q,{backdrop:"blur",isOpen:l,onOpenChange:a,children:e.jsx(S,{children:()=>e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"flex flex-col gap-1",children:r("deleteConnection")}),e.jsx(T,{children:e.jsx("div",{className:"flex",children:r("deleteConfirmation")})}),e.jsxs(R,{children:[e.jsx(f,{variant:"bordered",className:"border border-divider",onPress:t,children:r("cancel")}),e.jsx(f,{color:"danger",startContent:e.jsx(m,{icon:I}),isLoading:o,onPress:()=>p(),children:r("delete")})]})]})})})}function te({connection:s,isOpen:l,onClose:t,onOpenChange:a}){const{t:r}=g(),{rxdb:u}=b.useContext(E),i=D(),{mutate:p,isPending:o}=N({mutationFn:async c=>{console.log(c);const w=await u.connections.findOne(s.id).exec();w&&(await w.incrementalModify(j=>(j.name=c.name,j.name=c.name,j.url=c.url,j.topic=c.topic,j.responseTopic=c.responseTopic,j.username=c.username||null,j)),i.resetQueries({queryKey:["CONNECTIONS"]}),t())}}),n=A({initialValues:{name:s.name,url:s.url,username:s.username||"",topic:s.topic,responseTopic:s.responseTopic},validationSchema:F({name:x().required(),url:x().matches(/^(wss?|WSS?):\/\/([a-zA-Z0-9.-]+|\[[0-9a-fA-F:]+\])(:\d{1,5})?(\/[^\s]*)?$/,{message:"Invalid mac adress"}).required(),username:x(),topic:x().required(),responseTopic:x().required()}),onSubmit(c){p(c)}}),[C,d]=b.useState(!!s.username);return e.jsx(q,{backdrop:"blur",scrollBehavior:"outside",isOpen:l,onOpenChange:a,children:e.jsx(S,{children:()=>e.jsxs("form",{onSubmit:n.handleSubmit,className:"flex flex-col gap-[1rem]",children:[e.jsx(P,{className:"flex flex-col gap-1",children:r("editConnection")}),e.jsxs(T,{children:[e.jsx(h,{isRequired:!0,formik:n,name:"name",label:r("name"),classNames:{inputWrapper:"shadow-none border border-divider"}}),e.jsx(h,{isRequired:!0,formik:n,name:"url",label:"URL",classNames:{inputWrapper:"shadow-none border border-divider"}}),e.jsx(h,{isRequired:!0,formik:n,name:"topic",label:"Topic",classNames:{inputWrapper:"shadow-none border border-divider"}}),e.jsx(h,{isRequired:!0,formik:n,name:"responseTopic",label:"Response Topic",classNames:{inputWrapper:"shadow-none border border-divider"}}),e.jsx(V,{isSelected:C,onValueChange:c=>{n.setFieldValue("username",""),d(c)},children:r("useAuthenthication")}),C?e.jsx(h,{isRequired:!0,formik:n,name:"username",label:r("username"),classNames:{inputWrapper:"shadow-none border border-divider"}}):null]}),e.jsx(R,{children:e.jsx(f,{fullWidth:!0,type:"submit",color:"primary",isLoading:o,startContent:e.jsx(m,{icon:L}),children:r("edit")})})]})})})}function le({onSubmit:s,isOpen:l,onClose:t,onOpenChange:a}){const{t:r}=g(),u=A({initialValues:{password:""},validationSchema:F({password:x().required()}),onSubmit(n){s(n.password),t()}}),[i,p]=b.useState(!1),o=()=>p(!i);return e.jsx(q,{backdrop:"blur",isOpen:l,onOpenChange:a,children:e.jsx(S,{children:()=>e.jsxs("form",{onSubmit:u.handleSubmit,className:"flex flex-col gap-[1rem]",children:[e.jsx(P,{className:"flex flex-col gap-1",children:r("connectionAuthenthication")}),e.jsx(T,{children:e.jsx(h,{isRequired:!0,type:i?"text":"password",formik:u,name:"password",label:r("password"),classNames:{inputWrapper:"shadow-none border border-divider"},endContent:e.jsx("button",{"aria-label":"toggle password visibility",className:"focus:outline-solid outline-transparent",type:"button",onClick:o,children:i?e.jsx(m,{icon:G}):e.jsx(m,{icon:X})})})}),e.jsx(R,{children:e.jsx(f,{fullWidth:!0,type:"submit",color:"primary",startContent:e.jsx(m,{icon:O}),children:r("connect")})})]})})})}function de({connection:s}){const{t:l}=g(),{connectionData:t,mqttConnect:a,mqttDisconnect:r}=b.useContext(Z),{isOpen:u,onOpen:i,onClose:p,onOpenChange:o}=y(),{isOpen:n,onOpen:C,onClose:d,onOpenChange:c}=y(),{isOpen:w,onOpen:j,onClose:k,onOpenChange:z}=y(),{mutate:_,isPending:M}=N({mutationFn:async W=>{await a(s,W)}}),{mutate:$,isPending:Q}=N({mutationFn:async()=>{await r()}});return e.jsxs(U,{className:"flex-row relative overflow-visible",children:[e.jsxs(K,{children:[e.jsx(oe,{connection:s,isOpen:n,onOpen:C,onOpenChange:c,onClose:d}),e.jsx(te,{connection:s,isOpen:u,onOpen:i,onOpenChange:o,onClose:p}),s.username?e.jsx(le,{isOpen:w,onOpen:j,onOpenChange:z,onClose:k,onSubmit:W=>_(W)}):null,e.jsxs("div",{className:"flex flex-col md:flex-row pr-[1.5rem] gap-[1rem]",children:[e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("div",{className:"flex font-bold text-[15pt] break-all",children:s.name}),e.jsx(v,{name:"URL",value:s.url}),e.jsx(v,{name:"Topic",value:s.topic}),e.jsx(v,{name:"Response topic",value:s.responseTopic}),s.username?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"flex font-bold text-[12pt]",children:l("authenthication")}),e.jsx(v,{name:l("username"),value:s.username})]}):null]}),e.jsxs("div",{className:"flex md:flex-col gap-[0.3rem]",children:[e.jsx(f,{size:"sm",radius:"full",variant:"bordered",className:"w-full md:w-auto border border-divider",isDisabled:t!==null,endContent:e.jsx(m,{icon:L}),onPress:()=>i(),children:l("edit")}),e.jsx(f,{size:"sm",radius:"full",variant:"bordered",className:"w-full md:w-auto border border-divider",isDisabled:t!==null,endContent:e.jsx(m,{icon:I}),onPress:()=>C(),children:l("delete")})]})]})]}),e.jsx("div",{className:"flex items-center",children:t&&t.id===s.id?e.jsx(f,{isIconOnly:!0,color:"danger",variant:"shadow",radius:"full",size:"lg",isLoading:Q,className:"absolute right-0 translate-x-[50%] z-10",onPress:()=>$(),children:e.jsx(m,{icon:J})}):e.jsx(f,{isIconOnly:!0,color:"primary",variant:"shadow",radius:"full",size:"lg",isDisabled:t!==null,isLoading:M,className:"absolute right-0 translate-x-[50%] z-10",onPress:()=>{console.log("lol",s.username),s.username?(console.log("lol"),j()):_(void 0)},children:e.jsx(m,{icon:Y})})})]})}function he(){const{t:s}=g(),{rxdb:l}=b.useContext(E),{isOpen:t,onOpen:a,onClose:r,onOpenChange:u}=y(),{data:i,isLoading:p,isError:o}=B({queryKey:["CONNECTIONS"],queryFn:async()=>await l.connections.find().exec()});return e.jsx("div",{className:"flex flex-1 flex-col items-center",children:e.jsxs("div",{className:"flex flex-1 flex-col max-w-screen-md w-full",children:[e.jsxs("div",{className:"flex justify-between items-center z-10 py-[1rem] px-[1rem]",children:[e.jsx(ne,{icon:ee,title:`${s("connections")} (${i?.length||0})`}),e.jsx(f,{isIconOnly:!0,color:"primary",variant:"bordered",radius:"full",className:"h-[3.5rem] w-[3.5rem]",onPress:a,children:e.jsx(m,{icon:O,className:"text-[18pt]"})}),e.jsx(ie,{isOpen:t,onOpenChange:u,onClose:r,onOpen:a})]}),p?e.jsx(re,{}):o?e.jsx(H,{}):i&&i.length?e.jsx("div",{className:"flex flex-col flex-1 mt-[0.5rem] gap-[1rem] pl-[1rem] pr-[2.5rem] pb-[5rem]",children:i.map(n=>e.jsx(de,{connection:n},n.id))}):e.jsxs("div",{className:"flex flex-1 text-center justify-center items-center flex-col gap-[1rem] px-[0.5rem]",children:[e.jsx("img",{src:ae,alt:"device",className:"h-[12rem] md:h-[15rem]"}),e.jsx("div",{className:"flex text-[18pt] font-bold",children:s("noConnections.title")}),e.jsx("div",{className:"flex text-[13pt] opacity-70",children:s("noConnections.subTitle")}),e.jsx(f,{radius:"full",color:"primary",variant:"ghost",startContent:e.jsx(m,{icon:O}),onPress:a,children:s("addConnection")})]})]})})}export{he as component};
