import{r as h,j as e,m as C,a as y,b as N,c as w,d as D,e as t,u as v,l as F,n as M}from"./heroui-XROrhaFW.js";import{R as b,u as O,c as E,d as R,E as V}from"./index-EKBqu4E4.js";import{q as g,r as I,s as S,v as k,w as L,e as $}from"./fortawesome-free-solid-svg-icons-CoRImyFt.js";import{F as x,M as z}from"./mqtt-D0UgJ9oq.js";import{v as P,u as A,c as _,a as p,V as f,D as q,H as W,L as Q,E as B}from"./loading-screen-Do3_2Vye.js";function K({isOpen:a,onClose:r,onOpenChange:i}){const{rxdb:o}=h.useContext(b),d=O(),{mutate:n,isPending:c}=E({mutationFn:async s=>{console.log({id:P(),name:s.name,mac:s.mac,ip:s.ip||null}),await o.devices.insert({id:P(),name:s.name,mac:s.mac,ip:s.ip||null}),d.resetQueries({queryKey:["DEVICES"]}),r()}}),l=A({initialValues:{name:"",mac:"",ip:""},validationSchema:_({name:p().required(),mac:p().matches(/^([0-9A-Fa-f]{2}:){5}[0-9A-Fa-f]{2}$/,{message:"Invalid mac adress"}).required(),ip:p().matches(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,{message:"Invalid ip adress"})}),onSubmit(s){n(s)}});return e.jsx(C,{backdrop:"blur",scrollBehavior:"outside",isOpen:a,onOpenChange:i,children:e.jsx(y,{children:()=>e.jsxs("form",{onSubmit:l.handleSubmit,className:"flex flex-col gap-[1rem]",children:[e.jsx(N,{className:"flex flex-col gap-1",children:"Add device"}),e.jsxs(w,{children:[e.jsx(f,{isRequired:!0,formik:l,name:"name",label:"Name",classNames:{inputWrapper:"shadow-none border border-divider"}}),e.jsx(f,{isRequired:!0,formik:l,name:"mac",label:"Mac address",classNames:{inputWrapper:"shadow-none border border-divider"}}),e.jsx(f,{formik:l,name:"ip",label:"IP address (Optional: for PING)",classNames:{inputWrapper:"shadow-none border border-divider"}})]}),e.jsx(D,{children:e.jsx(t,{fullWidth:!0,type:"submit",color:"primary",isLoading:c,startContent:e.jsx(x,{icon:g}),children:"Add"})})]})})})}function G({device:a,isOpen:r,onClose:i,onOpenChange:o}){const{rxdb:d}=h.useContext(b),n=O(),{mutate:c,isPending:l}=E({mutationFn:async()=>{const s=await d.devices.findOne(a.id).exec();s&&(await s.remove(),n.resetQueries({queryKey:["DEVICES"]}),i())}});return e.jsx(C,{backdrop:"blur",isOpen:r,onOpenChange:o,children:e.jsx(y,{children:()=>e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"flex flex-col gap-1",children:"Delete device"}),e.jsx(w,{children:e.jsx("div",{className:"flex",children:"Are you sure you want to delete this device ?"})}),e.jsxs(D,{children:[e.jsx(t,{variant:"bordered",className:"border border-divider",onPress:i,children:"Cancel"}),e.jsx(t,{color:"danger",startContent:e.jsx(x,{icon:I}),isLoading:l,onPress:()=>c(),children:"Delete"})]})]})})})}function H({device:a,isOpen:r,onClose:i,onOpenChange:o}){const{rxdb:d}=h.useContext(b),n=O(),{mutate:c,isPending:l}=E({mutationFn:async m=>{console.log(m);const j=await d.devices.findOne(a.id).exec();j&&(await j.incrementalModify(u=>(u.name=m.name,u.mac=m.mac,u.ip=m.ip||null,u)),n.resetQueries({queryKey:["DEVICES"]}),i())}}),s=A({initialValues:{name:a.name,mac:a.mac,ip:a.ip||""},validationSchema:_({name:p().required(),mac:p().matches(/^([0-9A-Fa-f]{2}:){5}[0-9A-Fa-f]{2}$/,{message:"Invalid mac adress"}).required(),ip:p().matches(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,{message:"Invalid ip adress"})}),onSubmit(m){c(m)}});return e.jsx(C,{backdrop:"blur",scrollBehavior:"outside",isOpen:r,onOpenChange:o,children:e.jsx(y,{children:()=>e.jsxs("form",{onSubmit:s.handleSubmit,className:"flex flex-col gap-[1rem]",children:[e.jsx(N,{className:"flex flex-col gap-1",children:"Edit device"}),e.jsxs(w,{children:[e.jsx(f,{isRequired:!0,formik:s,name:"name",label:"Name",placeholder:"Device name"}),e.jsx(f,{isRequired:!0,formik:s,name:"mac",label:"Mac address",placeholder:"00:1A:2B:3C:4D:5E"}),e.jsx(f,{formik:s,name:"ip",label:"IP address (Optional: for PING)",classNames:{inputWrapper:"shadow-none border border-divider"}})]}),e.jsx(D,{children:e.jsx(t,{fullWidth:!0,type:"submit",color:"primary",isLoading:l,startContent:e.jsx(x,{icon:S}),children:"Edit"})})]})})})}function T({device:a}){const{connectionData:r,wakeDevice:i,pingDevice:o}=h.useContext(z),{isOpen:d,onOpen:n,onClose:c,onOpenChange:l}=v(),{isOpen:s,onOpen:m,onClose:j,onOpenChange:u}=v();return e.jsxs(F,{className:"flex-row relative overflow-visible",children:[e.jsxs(M,{children:[e.jsx(G,{device:a,isOpen:s,onOpen:m,onOpenChange:u,onClose:j}),e.jsx(H,{device:a,isOpen:d,onOpen:n,onOpenChange:l,onClose:c}),e.jsxs("div",{className:"flex flex-col md:flex-row pr-[1.5rem] gap-[1rem]",children:[e.jsxs("div",{className:"flex flex-col flex-1",children:[e.jsx("div",{className:"flex font-bold text-[15pt] break-all",children:a.name}),e.jsx(q,{name:"MAC",value:a.mac}),e.jsx(q,{name:"IP",value:a.ip||"Not set"})]}),e.jsxs("div",{className:"flex md:flex-col gap-[0.3rem]",children:[e.jsx(t,{size:"sm",radius:"full",variant:"bordered",className:"w-full md:w-auto border border-divider",isDisabled:!(r&&r.isConnected)||!a.ip,endContent:e.jsx(x,{icon:k}),onPress:()=>o(a),children:"Ping"}),e.jsx(t,{size:"sm",radius:"full",variant:"bordered",className:"w-full md:w-auto border border-divider",endContent:e.jsx(x,{icon:S}),onPress:()=>n(),children:"Edit"}),e.jsx(t,{size:"sm",radius:"full",variant:"bordered",className:"w-full md:w-auto border border-divider",endContent:e.jsx(x,{icon:I}),onPress:()=>m(),children:"Delete"})]})]})]}),e.jsx("div",{className:"flex items-center",children:e.jsx(t,{isIconOnly:!0,color:"primary",variant:"shadow",radius:"full",size:"lg",isDisabled:!(r&&r.isConnected),className:"absolute right-0 translate-x-[50%] z-10",onPress:()=>i(a),children:e.jsx(x,{icon:L})})})]})}function ee(){const{rxdb:a}=h.useContext(b),{isOpen:r,onOpen:i,onClose:o,onOpenChange:d}=v(),{data:n,isLoading:c,isError:l}=R({queryKey:["DEVICES"],queryFn:async()=>await a.devices.find().exec()});return e.jsx("div",{className:"flex flex-1 flex-col items-center",children:e.jsxs("div",{className:"flex flex-1 flex-col max-w-screen-md w-full",children:[e.jsxs("div",{className:"flex justify-between items-center z-10 py-[1rem] px-[1rem]",children:[e.jsx(W,{icon:$,title:`Devices (${n?.length||0})`}),e.jsx(t,{isIconOnly:!0,color:"primary",variant:"bordered",radius:"full",className:"h-[3.5rem] w-[3.5rem]",onPress:i,children:e.jsx(x,{icon:g,className:"text-[18pt]"})}),e.jsx(K,{isOpen:r,onOpenChange:d,onClose:o,onOpen:i})]}),c?e.jsx(Q,{}):l?e.jsx(V,{}):n&&n.length?e.jsx("div",{className:"flex flex-col flex-1 mt-[0.5rem] gap-[1rem] pl-[1rem] pr-[2.5rem] pb-[5rem]",children:n.map(s=>e.jsx(T,{device:s},s.id))}):e.jsxs("div",{className:"flex flex-1 text-center justify-center items-center flex-col gap-[1rem] px-[0.5rem]",children:[e.jsx("img",{src:B,alt:"device",className:"h-[12rem] md:h-[15rem]"}),e.jsx("div",{className:"flex text-[18pt] font-bold",children:"No devices yet"}),e.jsx("div",{className:"flex text-[13pt] opacity-70",children:"Start by adding a device identified by its mac adress"}),e.jsx(t,{radius:"full",color:"primary",variant:"ghost",startContent:e.jsx(x,{icon:g}),onPress:i,children:"Add device"})]})]})})}export{ee as component};
